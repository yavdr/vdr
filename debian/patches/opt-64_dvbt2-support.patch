Description: DVB-T2 support for VDR
Author: Rolf Ahrenberg <Rolf.Ahrenberg AT sci.fi>
Origin: http://www.saunalahti.fi/~rahrenbe/vdr/patches/index.php

diff -urNad vdr-1.7.22-orig/dvbdevice.c vdr-1.7.22-dvbt2/dvbdevice.c
--- vdr-1.7.22-orig/dvbdevice.c	2011-12-23 17:39:52.000000000 +0100
+++ vdr-1.7.22-dvbt2/dvbdevice.c	2011-12-23 17:47:44.304721390 +0100
@@ -44,9 +44,12 @@
   };
 
 const tDvbParameterMap BandwidthValues[] = {
+  {   5, 5000000, "5 MHz" },
   {   6, 6000000, "6 MHz" },
   {   7, 7000000, "7 MHz" },
   {   8, 8000000, "8 MHz" },
+  {  10, 10000000, "10 MHz" },
+  { 1712, 1712000, "1.712 MHz" },
   {  -1, 0, NULL }
   };
 
@@ -75,8 +78,10 @@
   {   2, QPSK,     "QPSK" },
   {   5, PSK_8,    "8PSK" },
   {   6, APSK_16,  "16APSK" },
+  {   7, APSK_32,  "32APSK" },
   {  10, VSB_8,    "VSB8" },
   {  11, VSB_16,   "VSB16" },
+  {  12, DQPSK,    "DQPSK" },
   { 998, QAM_AUTO, "QAMAUTO" },
   {  -1, 0, NULL }
   };
@@ -84,12 +89,18 @@
 const tDvbParameterMap SystemValues[] = {
   {   0, SYS_DVBS,  "DVB-S" },
   {   1, SYS_DVBS2, "DVB-S2" },
+  {   2, SYS_DVBT,  "DVB-T" },
+  {   3, SYS_DVBT2, "DVB-T2" },
   {  -1, 0, NULL }
   };
 
 const tDvbParameterMap TransmissionValues[] = {
+  {   1, TRANSMISSION_MODE_1K,   "1K" },
   {   2, TRANSMISSION_MODE_2K,   "2K" },
+  {   4, TRANSMISSION_MODE_4K,   "4K" },
   {   8, TRANSMISSION_MODE_8K,   "8K" },
+  {  16, TRANSMISSION_MODE_16K,  "16K" },
+  {  32, TRANSMISSION_MODE_32K,  "32K" },
   { 999, TRANSMISSION_MODE_AUTO, trNOOP("auto") },
   {  -1, 0, NULL }
   };
@@ -99,7 +110,10 @@
   {   8, GUARD_INTERVAL_1_8,  "1/8" },
   {  16, GUARD_INTERVAL_1_16, "1/16" },
   {  32, GUARD_INTERVAL_1_32, "1/32" },
-  { 999, GUARD_INTERVAL_AUTO, trNOOP("auto") },
+  {   128, GUARD_INTERVAL_1_128,  "1/128" },
+  { 19128, GUARD_INTERVAL_19_128, "19/128" },
+  { 19256, GUARD_INTERVAL_19_256, "19/256" },
+  { 999,   GUARD_INTERVAL_AUTO, trNOOP("auto") },
   {  -1, 0, NULL }
   };
 
@@ -184,6 +198,7 @@
   guard        = GUARD_INTERVAL_AUTO;
   hierarchy    = HIERARCHY_AUTO;
   rollOff      = ROLLOFF_AUTO;
+  plpId        = 0;
   Parse(Parameters);
 }
 
@@ -206,9 +221,10 @@
   ST("ACST")  q += PrintParameter(q, 'I', MapToUser(inversion, InversionValues));
   ST("ACST")  q += PrintParameter(q, 'M', MapToUser(modulation, ModulationValues));
   ST("  S ")  q += PrintParameter(q, 'O', MapToUser(rollOff, RollOffValues));
-  ST("  S ")  q += PrintParameter(q, 'S', MapToUser(system, SystemValues));
+  ST("  ST")  q += PrintParameter(q, 'S', MapToUser(system, SystemValues));
   ST("   T")  q += PrintParameter(q, 'T', MapToUser(transmission, TransmissionValues));
   ST("   T")  q += PrintParameter(q, 'Y', MapToUser(hierarchy, HierarchyValues));
+  ST("   T")  q += PrintParameter(q, 'P', plpId);
   return buffer;
 }
 
@@ -228,6 +244,22 @@
   return NULL;
 }
 
+const char *cDvbTransponderParameters::ParseParameter(const char *s, int &Value)
+{
+  if (*++s) {
+     char *p = NULL;
+     errno = 0;
+     int n = strtol(s, &p, 10);
+     if (!errno && p != s) {
+        Value = n;
+        if (Value >= 0)
+           return p;
+        }
+     }
+  esyslog("ERROR: invalid value for parameter '%c'", *(s - 1));
+  return NULL;
+}
+
 bool cDvbTransponderParameters::Parse(const char *s)
 {
   while (s && *s) {
@@ -246,6 +278,7 @@
           case 'T': s = ParseParameter(s, transmission, TransmissionValues); break;
           case 'V': polarization = *s++; break;
           case 'Y': s = ParseParameter(s, hierarchy, HierarchyValues); break;
+          case 'P': s = ParseParameter(s, plpId); break;
           default: esyslog("ERROR: unknown parameter key '%c'", *s);
                    return false;
           }
@@ -800,8 +833,8 @@
      tuneTimeout = DVBC_TUNE_TIMEOUT;
      lockTimeout = DVBC_LOCK_TIMEOUT;
      }
-  else if (frontendType == SYS_DVBT) {
-     // DVB-T
+  else if (frontendType == SYS_DVBT || frontendType == SYS_DVBT2) {
+     // DVB-T & DVB-T2
      SETCMD(DTV_DELIVERY_SYSTEM, frontendType);
      SETCMD(DTV_FREQUENCY, FrequencyToHz(channel.Frequency()));
      SETCMD(DTV_INVERSION, dtp.Inversion());
@@ -812,7 +845,10 @@
      SETCMD(DTV_TRANSMISSION_MODE, dtp.Transmission());
      SETCMD(DTV_GUARD_INTERVAL, dtp.Guard());
      SETCMD(DTV_HIERARCHY, dtp.Hierarchy());
-
+     if (frontendType == SYS_DVBT2) {
+        // DVB-T2
+        SETCMD(DTV_DVBT2_PLP_ID, dtp.PlpId());
+        }
      tuneTimeout = DVBT_TUNE_TIMEOUT;
      lockTimeout = DVBT_LOCK_TIMEOUT;
      }
@@ -984,7 +1020,7 @@
 #define ST(s) if (strchr(s, type))
   switch (param++) {
     case  0: ST("  S ")  return new cMenuEditChrItem( tr("Polarization"), &dtp.polarization, "HVLR");             else return GetOsdItem();
-    case  1: ST("  S ")  return new cMenuEditMapItem( tr("System"),       &dtp.system,       SystemValues);       else return GetOsdItem();
+    case  1: ST("  ST")  return new cMenuEditMapItem( tr("System"),       &dtp.system,       SystemValues);       else return GetOsdItem();
     case  2: ST(" CS ")  return new cMenuEditIntItem( tr("Srate"),        &srate);                                else return GetOsdItem();
     case  3: ST("ACST")  return new cMenuEditMapItem( tr("Inversion"),    &dtp.inversion,    InversionValues);    else return GetOsdItem();
     case  4: ST(" CST")  return new cMenuEditMapItem( tr("CoderateH"),    &dtp.coderateH,    CoderateValues);     else return GetOsdItem();
@@ -995,6 +1031,7 @@
     case  9: ST("   T")  return new cMenuEditMapItem( tr("Guard"),        &dtp.guard,        GuardValues);        else return GetOsdItem();
     case 10: ST("   T")  return new cMenuEditMapItem( tr("Hierarchy"),    &dtp.hierarchy,    HierarchyValues);    else return GetOsdItem();
     case 11: ST("  S ")  return new cMenuEditMapItem( tr("Rolloff"),      &dtp.rollOff,      RollOffValues);      else return GetOsdItem();
+    case 12: ST("   T")  return new cMenuEditIntItem( tr("PlpId"),        &dtp.plpId,        0, 255);             else return GetOsdItem();
     default: return NULL;
     }
   return NULL;
@@ -1022,6 +1059,7 @@
   "DMBTH",
   "CMMB",
   "DAB",
+  "DVB-T2",
   NULL
   };
 
@@ -1057,7 +1095,7 @@
      if (ioctl(fd_frontend, FE_GET_INFO, &frontendInfo) >= 0) {
         switch (frontendInfo.type) {
           case FE_QPSK: frontendType = (frontendInfo.caps & FE_CAN_2G_MODULATION) ? SYS_DVBS2 : SYS_DVBS; break;
-          case FE_OFDM: frontendType = SYS_DVBT; break;
+          case FE_OFDM: frontendType = (frontendInfo.caps & FE_CAN_2G_MODULATION) ? SYS_DVBT2 : SYS_DVBT; break;
           case FE_QAM:  frontendType = SYS_DVBC_ANNEX_AC; break;
           case FE_ATSC: frontendType = SYS_ATSC; break;
           default: esyslog("ERROR: unknown frontend type %d on frontend %d/%d", frontendInfo.type, adapter, frontend);
@@ -1067,7 +1105,7 @@
         LOG_ERROR;
      if (frontendType != SYS_UNDEFINED) {
         numProvidedSystems++;
-        if (frontendType == SYS_DVBS2)
+        if (frontendType == SYS_DVBS2 || frontendType == SYS_DVBT2)
            numProvidedSystems++;
         char Modulations[64];
         char *p = Modulations;
@@ -1397,7 +1435,7 @@
       || type == cSource::stAtsc  && (frontendType == SYS_ATSC)
       || type == cSource::stCable && (frontendType == SYS_DVBC_ANNEX_AC || frontendType == SYS_DVBC_ANNEX_B)
       || type == cSource::stSat   && (frontendType == SYS_DVBS || frontendType == SYS_DVBS2)
-      || type == cSource::stTerr  && (frontendType == SYS_DVBT);
+      || type == cSource::stTerr  && (frontendType == SYS_DVBT || frontendType == SYS_DVBT2);
 }
 
 bool cDvbDevice::ProvidesTransponder(const cChannel *Channel) const
@@ -1406,6 +1444,7 @@
      return false; // doesn't provide source
   cDvbTransponderParameters dtp(Channel->Parameters());
   if (dtp.System() == SYS_DVBS2 && frontendType == SYS_DVBS ||
+     dtp.System() == SYS_DVBT2 && frontendType == SYS_DVBT ||
      dtp.Modulation() == QPSK     && !(frontendInfo.caps & FE_CAN_QPSK) ||
      dtp.Modulation() == QAM_16   && !(frontendInfo.caps & FE_CAN_QAM_16) ||
      dtp.Modulation() == QAM_32   && !(frontendInfo.caps & FE_CAN_QAM_32) ||
diff -urNad vdr-1.7.22-orig/dvbdevice.h vdr-1.7.22-dvbt2/dvbdevice.h
--- vdr-1.7.22-orig/dvbdevice.h	2011-12-23 17:39:52.000000000 +0100
+++ vdr-1.7.22-dvbt2/dvbdevice.h	2011-12-23 17:47:44.304721390 +0100
@@ -15,8 +15,8 @@
 #include <linux/dvb/version.h>
 #include "device.h"
 
-#if DVB_API_VERSION < 5
-#error VDR requires Linux DVB driver API version 5.0 or higher!
+#if DVB_API_VERSION < 5 || (DVB_API_VERSION == 5 && DVB_API_VERSION_MINOR < 3)
+#error VDR requires Linux DVB driver API version 5.3 or higher!
 #endif
 
 #define MAXDVBDEVICES  8
@@ -67,8 +67,10 @@
   int guard;
   int hierarchy;
   int rollOff;
+  int plpId;
   int PrintParameter(char *p, char Name, int Value) const;
   const char *ParseParameter(const char *s, int &Value, const tDvbParameterMap *Map);
+  const char *ParseParameter(const char *s, int &Value);
 public:
   cDvbTransponderParameters(const char *Parameters = NULL);
   char Polarization(void) const { return polarization; }
@@ -82,6 +84,7 @@
   int Guard(void) const { return guard; }
   int Hierarchy(void) const { return hierarchy; }
   int RollOff(void) const { return rollOff; }
+  int PlpId(void) const { return plpId; }
   void SetPolarization(char Polarization) { polarization = Polarization; }
   void SetInversion(int Inversion) { inversion = Inversion; }
   void SetBandwidth(int Bandwidth) { bandwidth = Bandwidth; }
@@ -93,6 +96,7 @@
   void SetGuard(int Guard) { guard = Guard; }
   void SetHierarchy(int Hierarchy) { hierarchy = Hierarchy; }
   void SetRollOff(int RollOff) { rollOff = RollOff; }
+  void SetPlpId(int PlpId) { plpId = PlpId; }
   cString ToString(char Type) const;
   bool Parse(const char *s);
   };
diff -urNad vdr-1.7.22-orig/libsi/descriptor.c vdr-1.7.22-dvbt2/libsi/descriptor.c
--- vdr-1.7.22-orig/libsi/descriptor.c	2011-12-22 15:44:29.000000000 +0100
+++ vdr-1.7.22-dvbt2/libsi/descriptor.c	2011-12-23 17:47:44.304721390 +0100
@@ -876,6 +876,52 @@
    return s->descriptor_tag_extension;
 }
 
+void T2DeliverySystemDescriptor::Parse() {
+   int offset=0;
+   data.setPointerAndOffset<const descr_t2_delivery_system>(s, offset);
+   extended_data_flag = s->descriptor_length > 0x04;
+}
+
+int T2DeliverySystemDescriptor::getExtendedDataFlag() const {
+  return extended_data_flag;
+}
+
+int T2DeliverySystemDescriptor::getExtensionDescriptorTag() const {
+   return s->descriptor_tag_extension;
+}
+
+int T2DeliverySystemDescriptor::getPlpId() const {
+   return s->plp_id;
+}
+
+int T2DeliverySystemDescriptor::getT2SystemId() const {
+   return HILO(s->t2_system_id);
+}
+
+int T2DeliverySystemDescriptor::getSisoMiso() const {
+   return extended_data_flag ? s->siso_miso : -1;
+}
+
+int T2DeliverySystemDescriptor::getBandwidth() const {
+   return extended_data_flag ? s->bandwidth : -1;
+}
+
+int T2DeliverySystemDescriptor::getGuardInterval() const {
+   return extended_data_flag ? s->guard_interval : -1;
+}
+
+int T2DeliverySystemDescriptor::getTransmissionMode() const {
+   return extended_data_flag ? s->transmission_mode : -1;
+}
+
+int T2DeliverySystemDescriptor::getOtherFrequencyFlag() const {
+   return extended_data_flag ? s->other_frequency_flag : -1;
+}
+
+int T2DeliverySystemDescriptor::getTfsFlag() const {
+   return extended_data_flag ? s->tfs_flag : -1;
+}
+
 int PremiereContentTransmissionDescriptor::getOriginalNetworkId() const {
    return HILO(s->original_network_id);
 }
diff -urNad vdr-1.7.22-orig/libsi/descriptor.h vdr-1.7.22-dvbt2/libsi/descriptor.h
--- vdr-1.7.22-orig/libsi/descriptor.h	2011-12-22 15:44:29.000000000 +0100
+++ vdr-1.7.22-dvbt2/libsi/descriptor.h	2011-12-23 17:47:44.314721390 +0100
@@ -538,6 +538,25 @@
    const descr_extension *s;
 };
 
+class T2DeliverySystemDescriptor : public Descriptor {
+public:
+   int getExtendedDataFlag() const;
+   int getExtensionDescriptorTag() const;
+   int getPlpId() const;
+   int getT2SystemId() const;
+   int getSisoMiso() const;
+   int getBandwidth() const;
+   int getGuardInterval() const;
+   int getTransmissionMode() const;
+   int getOtherFrequencyFlag() const;
+   int getTfsFlag() const;
+protected:
+   virtual void Parse();
+private:
+   const descr_t2_delivery_system *s;
+   int extended_data_flag;
+};
+
 // Private DVB Descriptor  Premiere.de
 // 0xF2  Content Transmission Descriptor
 // http://dvbsnoop.sourceforge.net/examples/example-private-section.html
diff -urNad vdr-1.7.22-orig/libsi/headers.h vdr-1.7.22-dvbt2/libsi/headers.h
--- vdr-1.7.22-orig/libsi/headers.h	2011-12-22 15:44:29.000000000 +0100
+++ vdr-1.7.22-dvbt2/libsi/headers.h	2011-12-23 17:47:44.314721390 +0100
@@ -1839,6 +1839,37 @@
    u_char descriptor_tag_extension               :8;
 };
 
+/* extension 0x04 t2_delivery_system_descriptor */
+
+struct descr_t2_delivery_system {
+   u_char descriptor_tag                         :8;
+   u_char descriptor_length                      :8;
+   u_char descriptor_tag_extension               :8;
+   u_char plp_id                                 :8;
+   u_char t2_system_id_hi                        :8;
+   u_char t2_system_id_lo                        :8;
+#if BYTE_ORDER == BIG_ENDIAN
+   u_char siso_miso                              :2;
+   u_char bandwidth                              :4;
+   u_char reserved                               :2;
+   u_char guard_interval                         :3;
+   u_char transmission_mode                      :3;
+   u_char other_frequency_flag                   :1;
+   u_char tfs_flag                               :1;
+#else
+   u_char reserved                               :2;
+   u_char bandwidth                              :4;
+   u_char siso_miso                              :2;
+   u_char tfs_flag                               :1;
+   u_char other_frequency_flag                   :1;
+   u_char transmission_mode                      :3;
+   u_char guard_interval                         :3;
+#endif
+/* now follow cell_id, frequency_loop_length, centre_frequency,
+   subcell_info_loop_length, cell_id_extension, transposer_frequency
+   fields looping to the end */
+};
+
 /* MHP 0x00 application_descriptor */
 
 #define DESCR_APPLICATION_LEN 3
diff -urNad vdr-1.7.22-orig/libsi/si.h vdr-1.7.22-dvbt2/libsi/si.h
--- vdr-1.7.22-orig/libsi/si.h	2011-12-22 15:44:29.000000000 +0100
+++ vdr-1.7.22-dvbt2/libsi/si.h	2011-12-23 17:47:44.314721390 +0100
@@ -134,6 +134,19 @@
                DTSDescriptorTag = 0x7B,
                AACDescriptorTag = 0x7C,
                ExtensionDescriptorTag = 0x7F,
+ // Extension descriptors
+               ImageIconDescriptorTag = 0x00,
+               CpcmDeliverySignallingDescriptor = 0x01,
+               CPDescriptorTag = 0x02,
+               CPIdentifierDescriptorTag = 0x03,
+               T2DeliverySystemDescriptorTag = 0x04,
+               SHDeliverySystemDescriptorTag = 0x05,
+               SupplementaryAudioDescriptorTag = 0x06,
+               NetworkChangeNotifyDescriptorTag = 0x07,
+               MessageDescriptorTag = 0x08,
+               TargetRegionDescriptorTag = 0x09,
+               TargetRegionNameDescriptorTag = 0x0A,
+               ServiceRelocatedDescriptorTag = 0x0B,
 
  // Defined by ETSI TS 102 812 (MHP)
                // They once again start with 0x00 (see page 234, MHP specification)
diff -urNad vdr-1.7.22-orig/nit.c vdr-1.7.22-dvbt2/nit.c
--- vdr-1.7.22-orig/nit.c	2011-12-22 15:44:29.000000000 +0100
+++ vdr-1.7.22-dvbt2/nit.c	2011-12-23 17:47:44.314721390 +0100
@@ -242,7 +242,8 @@
                  cDvbTransponderParameters dtp;
                  int Source = cSource::FromData(cSource::stTerr);
                  int Frequency = Frequencies[0] = sd->getFrequency() * 10;
-                 static int Bandwidths[] = { 8000000, 7000000, 6000000, 0, 0, 0, 0, 0 };
+                 dtp.SetSystem(SYS_DVBT);
+                 static int Bandwidths[] = { 8000000, 7000000, 6000000, 5000000, 0, 0, 0, 0 };
                  dtp.SetBandwidth(Bandwidths[sd->getBandwidth()]);
                  static int Constellations[] = { QPSK, QAM_16, QAM_64, QAM_AUTO };
                  dtp.SetModulation(Constellations[sd->getConstellation()]);
@@ -253,7 +254,7 @@
                  dtp.SetCoderateL(CodeRates[sd->getCodeRateLP()]);
                  static int GuardIntervals[] = { GUARD_INTERVAL_1_32, GUARD_INTERVAL_1_16, GUARD_INTERVAL_1_8, GUARD_INTERVAL_1_4 };
                  dtp.SetGuard(GuardIntervals[sd->getGuardInterval()]);
-                 static int TransmissionModes[] = { TRANSMISSION_MODE_2K, TRANSMISSION_MODE_8K, TRANSMISSION_MODE_AUTO, TRANSMISSION_MODE_AUTO };
+                 static int TransmissionModes[] = { TRANSMISSION_MODE_2K, TRANSMISSION_MODE_8K, TRANSMISSION_MODE_4K, TRANSMISSION_MODE_AUTO };
                  dtp.SetTransmission(TransmissionModes[sd->getTransmissionMode()]);
                  if (ThisNIT >= 0) {
                     for (int n = 0; n < NumFrequencies; n++) {
@@ -299,6 +300,40 @@
                     }
                  }
                  break;
+            case SI::ExtensionDescriptorTag: {
+                 SI::ExtensionDescriptor *sd = (SI::ExtensionDescriptor *)d;
+                 switch (sd->getExtensionDescriptorTag()) {
+                   case SI::T2DeliverySystemDescriptorTag: {
+                        if (Setup.UpdateChannels >= 5) {
+                           for (cChannel *Channel = Channels.First(); Channel; Channel = Channels.Next(Channel)) {
+                               int Source = cSource::FromData(cSource::stTerr);
+                               if (!Channel->GroupSep() && Channel->Source() == Source && Channel->Nid() == ts.getOriginalNetworkId() && Channel->Tid() == ts.getTransportStreamId()) {
+                                  SI::T2DeliverySystemDescriptor *td = (SI::T2DeliverySystemDescriptor *)d;
+                                  int Frequency = Channel->Frequency();
+                                  int SymbolRate = Channel->Srate();
+                                  cDvbTransponderParameters dtp(Channel->Parameters());
+                                  dtp.SetSystem(SYS_DVBT2);
+                                  dtp.SetPlpId(td->getPlpId());
+                                  if (td->getExtendedDataFlag()) {
+                                     static int T2Bandwidths[] = { 8000000, 7000000, 6000000, 5000000, 10000000, 1712000, 0, 0 };
+                                     dtp.SetBandwidth(T2Bandwidths[td->getBandwidth()]);
+                                     static int T2GuardIntervals[] = { GUARD_INTERVAL_1_32, GUARD_INTERVAL_1_16, GUARD_INTERVAL_1_8, GUARD_INTERVAL_1_4,
+                                                                       GUARD_INTERVAL_1_128, GUARD_INTERVAL_19_128, GUARD_INTERVAL_19_256, 0 };
+                                     dtp.SetGuard(T2GuardIntervals[td->getGuardInterval()]);
+                                     static int T2TransmissionModes[] = { TRANSMISSION_MODE_2K, TRANSMISSION_MODE_8K, TRANSMISSION_MODE_4K, TRANSMISSION_MODE_1K,
+                                                                          TRANSMISSION_MODE_16K, TRANSMISSION_MODE_32K, TRANSMISSION_MODE_AUTO, TRANSMISSION_MODE_AUTO };
+                                     dtp.SetTransmission(T2TransmissionModes[td->getTransmissionMode()]);
+                                     }
+                                  Channel->SetTransponderData(Source, Frequency, SymbolRate, dtp.ToString('T'));
+                                  }
+                               }
+                           }
+                        }
+                        break;
+                   default: ;
+                   }
+                 }
+                 break;
             default: ;
             }
           delete d;
diff -urNad vdr-1.7.22-orig/po/ar.po vdr-1.7.22-dvbt2/po/ar.po
--- vdr-1.7.22-orig/po/ar.po	2011-12-22 15:44:29.000000000 +0100
+++ vdr-1.7.22-dvbt2/po/ar.po	2011-12-23 17:47:44.314721390 +0100
@@ -79,6 +79,9 @@
 msgid "Rolloff"
 msgstr "ÿßŸäŸÇÿßŸÅ"
 
+msgid "PlpId"
+msgstr ""
+
 msgid "Starting EPG scan"
 msgstr "EPG ÿß ŸÑÿ®ÿØÿ° ÿ®ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÑŸâ ÿØŸÑŸäŸÑ ÿßŸÑŸÇŸÜŸàÿßÿ™ ÿßŸÑÿßŸÑŸÉÿ™ÿ±ŸàŸÜŸâ "
 
diff -urNad vdr-1.7.22-orig/po/ca_ES.po vdr-1.7.22-dvbt2/po/ca_ES.po
--- vdr-1.7.22-orig/po/ca_ES.po	2011-12-23 17:39:51.000000000 +0100
+++ vdr-1.7.22-dvbt2/po/ca_ES.po	2011-12-23 17:47:44.314721390 +0100
@@ -76,6 +76,9 @@
 msgid "Rolloff"
 msgstr ""
 
+msgid "PlpId"
+msgstr ""
+
 msgid "Starting EPG scan"
 msgstr "Iniciant exploraciÛ EPG"
 
diff -urNad vdr-1.7.22-orig/po/cs_CZ.po vdr-1.7.22-dvbt2/po/cs_CZ.po
--- vdr-1.7.22-orig/po/cs_CZ.po	2011-12-23 17:39:51.000000000 +0100
+++ vdr-1.7.22-dvbt2/po/cs_CZ.po	2011-12-23 17:47:44.314721390 +0100
@@ -75,6 +75,9 @@
 msgid "Rolloff"
 msgstr ""
 
+msgid "PlpId"
+msgstr ""
+
 msgid "Starting EPG scan"
 msgstr "Zaƒç√≠n√° prohled√°v√°n√≠ EPG"
 
diff -urNad vdr-1.7.22-orig/po/da_DK.po vdr-1.7.22-dvbt2/po/da_DK.po
--- vdr-1.7.22-orig/po/da_DK.po	2011-12-23 17:39:51.000000000 +0100
+++ vdr-1.7.22-dvbt2/po/da_DK.po	2011-12-23 17:47:44.324721390 +0100
@@ -73,6 +73,9 @@
 msgid "Rolloff"
 msgstr ""
 
+msgid "PlpId"
+msgstr ""
+
 msgid "Starting EPG scan"
 msgstr "Starter EPG skanning"
 
diff -urNad vdr-1.7.22-orig/po/de_DE.po vdr-1.7.22-dvbt2/po/de_DE.po
--- vdr-1.7.22-orig/po/de_DE.po	2011-12-23 17:39:52.000000000 +0100
+++ vdr-1.7.22-dvbt2/po/de_DE.po	2011-12-23 17:47:44.324721390 +0100
@@ -76,6 +76,9 @@
 msgid "Rolloff"
 msgstr "Rolloff"
 
+msgid "PlpId"
+msgstr ""
+
 msgid "Starting EPG scan"
 msgstr "Aktualisiere EPG-Daten"
 
diff -urNad vdr-1.7.22-orig/po/el_GR.po vdr-1.7.22-dvbt2/po/el_GR.po
--- vdr-1.7.22-orig/po/el_GR.po	2011-12-23 17:39:51.000000000 +0100
+++ vdr-1.7.22-dvbt2/po/el_GR.po	2011-12-23 17:47:44.324721390 +0100
@@ -73,6 +73,9 @@
 msgid "Rolloff"
 msgstr ""
 
+msgid "PlpId"
+msgstr ""
+
 msgid "Starting EPG scan"
 msgstr "¡Ò˜ﬁ Û‹Ò˘ÛÁ EPG"
 
diff -urNad vdr-1.7.22-orig/po/es_ES.po vdr-1.7.22-dvbt2/po/es_ES.po
--- vdr-1.7.22-orig/po/es_ES.po	2011-12-23 17:39:51.000000000 +0100
+++ vdr-1.7.22-dvbt2/po/es_ES.po	2011-12-23 17:47:44.324721390 +0100
@@ -74,6 +74,9 @@
 msgid "Rolloff"
 msgstr ""
 
+msgid "PlpId"
+msgstr ""
+
 msgid "Starting EPG scan"
 msgstr "Iniciando la exploraciÛn de EPG"
 
diff -urNad vdr-1.7.22-orig/po/et_EE.po vdr-1.7.22-dvbt2/po/et_EE.po
--- vdr-1.7.22-orig/po/et_EE.po	2011-12-23 17:39:51.000000000 +0100
+++ vdr-1.7.22-dvbt2/po/et_EE.po	2011-12-23 17:47:44.324721390 +0100
@@ -73,6 +73,9 @@
 msgid "Rolloff"
 msgstr "Rolloff"
 
+msgid "PlpId"
+msgstr ""
+
 msgid "Starting EPG scan"
 msgstr "EPG skaneerimine k‰ivitatud"
 
diff -urNad vdr-1.7.22-orig/po/fi_FI.po vdr-1.7.22-dvbt2/po/fi_FI.po
--- vdr-1.7.22-orig/po/fi_FI.po	2011-12-23 17:39:51.000000000 +0100
+++ vdr-1.7.22-dvbt2/po/fi_FI.po	2011-12-23 17:47:44.324721390 +0100
@@ -76,6 +76,9 @@
 msgid "Rolloff"
 msgstr "Rolloff"
 
+msgid "PlpId"
+msgstr "PLP-tunniste"
+
 msgid "Starting EPG scan"
 msgstr "Ohjelmaoppaan p√§ivitys aloitettu"
 
diff -urNad vdr-1.7.22-orig/po/fr_FR.po vdr-1.7.22-dvbt2/po/fr_FR.po
--- vdr-1.7.22-orig/po/fr_FR.po	2011-12-23 17:39:51.000000000 +0100
+++ vdr-1.7.22-dvbt2/po/fr_FR.po	2011-12-23 17:47:44.324721390 +0100
@@ -79,6 +79,9 @@
 msgid "Rolloff"
 msgstr ""
 
+msgid "PlpId"
+msgstr ""
+
 msgid "Starting EPG scan"
 msgstr "Mise ‡ jour du guide des programmes"
 
diff -urNad vdr-1.7.22-orig/po/hr_HR.po vdr-1.7.22-dvbt2/po/hr_HR.po
--- vdr-1.7.22-orig/po/hr_HR.po	2011-12-23 17:39:51.000000000 +0100
+++ vdr-1.7.22-dvbt2/po/hr_HR.po	2011-12-23 17:47:44.334721390 +0100
@@ -75,6 +75,9 @@
 msgid "Rolloff"
 msgstr ""
 
+msgid "PlpId"
+msgstr ""
+
 msgid "Starting EPG scan"
 msgstr "PoËinjem EPG pretragu"
 
diff -urNad vdr-1.7.22-orig/po/hu_HU.po vdr-1.7.22-dvbt2/po/hu_HU.po
--- vdr-1.7.22-orig/po/hu_HU.po	2011-12-23 17:39:51.000000000 +0100
+++ vdr-1.7.22-dvbt2/po/hu_HU.po	2011-12-23 17:47:44.334721390 +0100
@@ -76,6 +76,9 @@
 msgid "Rolloff"
 msgstr ""
 
+msgid "PlpId"
+msgstr ""
+
 msgid "Starting EPG scan"
 msgstr "EPG adatok aktualiz·l·sa"
 
diff -urNad vdr-1.7.22-orig/po/it_IT.po vdr-1.7.22-dvbt2/po/it_IT.po
--- vdr-1.7.22-orig/po/it_IT.po	2011-12-23 17:39:51.000000000 +0100
+++ vdr-1.7.22-dvbt2/po/it_IT.po	2011-12-23 17:47:44.334721390 +0100
@@ -80,6 +80,9 @@
 msgid "Rolloff"
 msgstr "Rolloff"
 
+msgid "PlpId"
+msgstr ""
+
 msgid "Starting EPG scan"
 msgstr "Inizio scansione EPG"
 
diff -urNad vdr-1.7.22-orig/po/lt_LT.po vdr-1.7.22-dvbt2/po/lt_LT.po
--- vdr-1.7.22-orig/po/lt_LT.po	2011-12-23 17:39:51.000000000 +0100
+++ vdr-1.7.22-dvbt2/po/lt_LT.po	2011-12-23 17:47:44.334721390 +0100
@@ -73,6 +73,9 @@
 msgid "Rolloff"
 msgstr "Rolloff"
 
+msgid "PlpId"
+msgstr ""
+
 msgid "Starting EPG scan"
 msgstr "Pradedamas EPG skanavimas"
 
diff -urNad vdr-1.7.22-orig/po/mk_MK.po vdr-1.7.22-dvbt2/po/mk_MK.po
--- vdr-1.7.22-orig/po/mk_MK.po	2011-12-22 15:44:29.000000000 +0100
+++ vdr-1.7.22-dvbt2/po/mk_MK.po	2011-12-23 17:47:44.334721390 +0100
@@ -74,6 +74,9 @@
 msgid "Rolloff"
 msgstr "–†–æ–ª-–æ—Ñ"
 
+msgid "PlpId"
+msgstr ""
+
 msgid "Starting EPG scan"
 msgstr "–ó–∞–ø–æ—á–Ω—É–≤–∞–º —Å–∫–µ–Ω–∏—Ä–∞—ö–µ –Ω–∞ EPG"
 
diff -urNad vdr-1.7.22-orig/po/nl_NL.po vdr-1.7.22-dvbt2/po/nl_NL.po
--- vdr-1.7.22-orig/po/nl_NL.po	2011-12-23 17:39:51.000000000 +0100
+++ vdr-1.7.22-dvbt2/po/nl_NL.po	2011-12-23 17:47:44.334721390 +0100
@@ -77,6 +77,9 @@
 msgid "Rolloff"
 msgstr ""
 
+msgid "PlpId"
+msgstr ""
+
 msgid "Starting EPG scan"
 msgstr "Bezig met starten EPG scan"
 
diff -urNad vdr-1.7.22-orig/po/nn_NO.po vdr-1.7.22-dvbt2/po/nn_NO.po
--- vdr-1.7.22-orig/po/nn_NO.po	2011-12-23 17:39:51.000000000 +0100
+++ vdr-1.7.22-dvbt2/po/nn_NO.po	2011-12-23 17:47:44.334721390 +0100
@@ -74,6 +74,9 @@
 msgid "Rolloff"
 msgstr ""
 
+msgid "PlpId"
+msgstr ""
+
 msgid "Starting EPG scan"
 msgstr ""
 
diff -urNad vdr-1.7.22-orig/po/pl_PL.po vdr-1.7.22-dvbt2/po/pl_PL.po
--- vdr-1.7.22-orig/po/pl_PL.po	2011-12-23 17:39:51.000000000 +0100
+++ vdr-1.7.22-dvbt2/po/pl_PL.po	2011-12-23 17:47:44.334721390 +0100
@@ -74,6 +74,9 @@
 msgid "Rolloff"
 msgstr ""
 
+msgid "PlpId"
+msgstr ""
+
 msgid "Starting EPG scan"
 msgstr "Rozpoczynam skanowanie EPG"
 
diff -urNad vdr-1.7.22-orig/po/pt_PT.po vdr-1.7.22-dvbt2/po/pt_PT.po
--- vdr-1.7.22-orig/po/pt_PT.po	2011-12-23 17:39:51.000000000 +0100
+++ vdr-1.7.22-dvbt2/po/pt_PT.po	2011-12-23 17:47:44.334721390 +0100
@@ -74,6 +74,9 @@
 msgid "Rolloff"
 msgstr "Rolloff"
 
+msgid "PlpId"
+msgstr ""
+
 msgid "Starting EPG scan"
 msgstr "A iniciar a busca do EPG"
 
diff -urNad vdr-1.7.22-orig/po/ro_RO.po vdr-1.7.22-dvbt2/po/ro_RO.po
--- vdr-1.7.22-orig/po/ro_RO.po	2011-12-23 17:39:51.000000000 +0100
+++ vdr-1.7.22-dvbt2/po/ro_RO.po	2011-12-23 17:47:44.344721390 +0100
@@ -76,6 +76,9 @@
 msgid "Rolloff"
 msgstr "Rolloff"
 
+msgid "PlpId"
+msgstr ""
+
 msgid "Starting EPG scan"
 msgstr "Pornesc achizi˛ia EPG"
 
diff -urNad vdr-1.7.22-orig/po/ru_RU.po vdr-1.7.22-dvbt2/po/ru_RU.po
--- vdr-1.7.22-orig/po/ru_RU.po	2011-12-23 17:39:51.000000000 +0100
+++ vdr-1.7.22-dvbt2/po/ru_RU.po	2011-12-23 17:47:44.344721390 +0100
@@ -74,6 +74,9 @@
 msgid "Rolloff"
 msgstr "Rolloff"
 
+msgid "PlpId"
+msgstr ""
+
 msgid "Starting EPG scan"
 msgstr "Ω–Áÿ›–Ó EPG-·⁄–›ÿ‡ﬁ“–›ÿ’"
 
diff -urNad vdr-1.7.22-orig/po/sk_SK.po vdr-1.7.22-dvbt2/po/sk_SK.po
--- vdr-1.7.22-orig/po/sk_SK.po	2011-12-23 17:39:51.000000000 +0100
+++ vdr-1.7.22-dvbt2/po/sk_SK.po	2011-12-23 17:47:44.344721390 +0100
@@ -73,6 +73,9 @@
 msgid "Rolloff"
 msgstr "Rolloff"
 
+msgid "PlpId"
+msgstr ""
+
 msgid "Starting EPG scan"
 msgstr "ZaËÌna prehµad·vaª EPG"
 
diff -urNad vdr-1.7.22-orig/po/sl_SI.po vdr-1.7.22-dvbt2/po/sl_SI.po
--- vdr-1.7.22-orig/po/sl_SI.po	2011-12-23 17:39:51.000000000 +0100
+++ vdr-1.7.22-dvbt2/po/sl_SI.po	2011-12-23 17:47:44.344721390 +0100
@@ -74,6 +74,9 @@
 msgid "Rolloff"
 msgstr ""
 
+msgid "PlpId"
+msgstr ""
+
 msgid "Starting EPG scan"
 msgstr "PriËenjam EPG-scan"
 
diff -urNad vdr-1.7.22-orig/po/sr_SR.po vdr-1.7.22-dvbt2/po/sr_SR.po
--- vdr-1.7.22-orig/po/sr_SR.po	2011-12-22 15:44:29.000000000 +0100
+++ vdr-1.7.22-dvbt2/po/sr_SR.po	2011-12-23 17:47:44.344721390 +0100
@@ -74,6 +74,9 @@
 msgid "Rolloff"
 msgstr ""
 
+msgid "PlpId"
+msgstr ""
+
 msgid "Starting EPG scan"
 msgstr "PoËinjem EPG pretragu"
 
diff -urNad vdr-1.7.22-orig/po/sv_SE.po vdr-1.7.22-dvbt2/po/sv_SE.po
--- vdr-1.7.22-orig/po/sv_SE.po	2011-12-23 17:39:51.000000000 +0100
+++ vdr-1.7.22-dvbt2/po/sv_SE.po	2011-12-23 17:47:44.344721390 +0100
@@ -76,6 +76,9 @@
 msgid "Rolloff"
 msgstr ""
 
+msgid "PlpId"
+msgstr ""
+
 msgid "Starting EPG scan"
 msgstr "PÂbˆrjar EPG skanning"
 
diff -urNad vdr-1.7.22-orig/po/tr_TR.po vdr-1.7.22-dvbt2/po/tr_TR.po
--- vdr-1.7.22-orig/po/tr_TR.po	2011-12-23 17:39:51.000000000 +0100
+++ vdr-1.7.22-dvbt2/po/tr_TR.po	2011-12-23 17:47:44.344721390 +0100
@@ -73,6 +73,9 @@
 msgid "Rolloff"
 msgstr ""
 
+msgid "PlpId"
+msgstr ""
+
 msgid "Starting EPG scan"
 msgstr "EPG tarama ba˛l˝yor"
 
diff -urNad vdr-1.7.22-orig/po/uk_UA.po vdr-1.7.22-dvbt2/po/uk_UA.po
--- vdr-1.7.22-orig/po/uk_UA.po	2011-12-23 17:39:51.000000000 +0100
+++ vdr-1.7.22-dvbt2/po/uk_UA.po	2011-12-23 17:47:44.354721390 +0100
@@ -73,6 +73,9 @@
 msgid "Rolloff"
 msgstr "–ö—Ä–µ–Ω"
 
+msgid "PlpId"
+msgstr ""
+
 msgid "Starting EPG scan"
 msgstr "–ü–æ—á–∏–Ω–∞—é EPG-—Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è"
 
diff -urNad vdr-1.7.22-orig/po/zh_CN.po vdr-1.7.22-dvbt2/po/zh_CN.po
--- vdr-1.7.22-orig/po/zh_CN.po	2011-12-23 17:39:51.000000000 +0100
+++ vdr-1.7.22-dvbt2/po/zh_CN.po	2011-12-23 17:47:44.354721390 +0100
@@ -76,6 +76,9 @@
 msgid "Rolloff"
 msgstr "Ë∂äÈõ∂Áéá"
 
+msgid "PlpId"
+msgstr ""
+
 msgid "Starting EPG scan"
 msgstr "ÂºÄÂßãËäÇÁõÆÂçïÊâ´Êèè"
 
diff -urNad vdr-1.7.22-orig/vdr.5 vdr-1.7.22-dvbt2/vdr.5
--- vdr-1.7.22-orig/vdr.5	2011-12-23 17:39:51.000000000 +0100
+++ vdr-1.7.22-dvbt2/vdr.5	2011-12-23 17:47:44.354721390 +0100
@@ -87,32 +87,33 @@
 .TS
 tab (@);
 l l.
-\fBB\fR@Bandwidth (6, 7, 8)
+\fBB\fR@Bandwidth (1712, 5, 6, 7, 8, 10)
 \fBC\fR@Code rate high priority (0, 12, 23, 34, 35, 45, 56, 67, 78, 89, 910)
 \fBD\fR@coDe rate low priority (0, 12, 23, 34, 35, 45, 56, 67, 78, 89, 910)
-\fBG\fR@Guard interval (4, 8, 16, 32)
+\fBG\fR@Guard interval (4, 8, 16, 32, 128, 191, 192)
 \fBH\fR@Horizontal polarization
 \fBI\fR@Inversion (0, 1)
 \fBL\fR@Left circular polarization
-\fBM\fR@Modulation (2, 5, 6, 10, 11, 16, 32, 64, 128, 256, 998)
+\fBM\fR@Modulation (2, 5, 6, 10, 11, 16, 32, 64, 128, 256, 998/999)
 \fBO\fR@rollOff (0, 20, 25, 35)
+\fBP\fR@Plp id (0-255)
 \fBR\fR@Right circular polarization
 \fBS\fR@delivery System (0, 1)
-\fBT\fR@Transmission mode (2, 8)
+\fBT\fR@Transmission mode (1, 2, 4, 8, 16, 32)
 \fBV\fR@Vertical polarization
 \fBY\fR@hierarchY (0, 1, 2, 4)
 .TE
 
-\fBBandwidth:\fR The bandwidth of the channel in MHz (DVB-T only).
+\fBBandwidth:\fR The bandwidth of the channel in MHz (1712 in kHz): (DVB-T/T2 only).
 
-\fBCode rate high priority:\fR Forward Error Correction (FEC) of the high priority stream (DVB-T).
+\fBCode rate high priority:\fR Forward Error Correction (FEC) of the high priority stream (DVB-T/T2).
 For DVB-S/DVB-S2 this parameter specifies the inner FEC scheme.
 12 = 1/2, 23 = 2/3, 34 = 3/4, ...
 
-\fBCode rate low priority:\fR Forward Error Correction (FEC) of the low priority stream (DVB-T only).
+\fBCode rate low priority:\fR Forward Error Correction (FEC) of the low priority stream (DVB-T/T2 only).
 If no hierarchy is used, set to 0.
 
-\fBGuard interval:\fR The guard interval value (DVB-T only): 4 = 1/4, 8 = 1/8, 16 = 1/16, 32 = 1/32.
+\fBGuard interval:\fR The guard interval value (DVB-T only): 4 = 1/4, 8 = 1/8, 16 = 1/16, 32 = 1/32, 128 = 1/128, 191 = 19/128, 192 = 19/256.
 
 \fBInversion:\fR Specifies whether the DVB frontend needs spectral inversion (DVB-T and DVB-C only). This is frontend specific, if in doubt, omit.
 
@@ -120,26 +121,30 @@
 .TS
 tab (@);
 l l.
-\fB2\fR@QPSK (DVB-S, DVB-S2, DVB-T)
+\fB2\fR@QPSK (DVB-S, DVB-S2, DVB-T, DVB-T2, ISDB-T)
 \fB5\fR@8PSK (DVB-S2)
 \fB6\fR@16APSK (DVB-S2)
+\fB7\fR@32APSK (DVB-S2)
 \fB10\fR@VSB8 (ATSC aerial)
 \fB11\fR@VSB16 (ATSC aerial)
-\fB16\fR@QAM16 (DVB-T)
-\fB64\fR@QAM64 (DVB-C, DVB-T)
+\fB12\fR@DQPSK (ISDB-T)
+\fB16\fR@QAM16 (DVB-T, DVB-T2, ISDB-T)
+\fB64\fR@QAM64 (DVB-C, DVB-T, DVB-T2, ISDB-T)
 \fB128\fR@QAM128 (DVB-C)
-\fB256\fR@QAM256 (DVB-C)
+\fB256\fR@QAM256 (DVB-C, DVB-T2)
 .TE
 
 \fBRolloff:\fR The Nyquist filter rolloff factor for DVB-S (\fB35\fR) and DVB-S2 (\fB35\fR, 25, 20),
 35 = 0.35, 25 = 0.25, 20 = 0.20, DVB-S/DVB-S2 default value is 0.35
 
-\fBTransmission mode:\fR Number of DVB-T OFDM carriers, 8 = 8k, 2 = 2k. If in doubt, try 8k.
+\fBPLP id:\fR Physical Layer Pipe (PLP) id (\fB0\fR-255) for DVB-T2 multiplex (DVB-T2 only).
+
+\fBTransmission mode:\fR Number of DVB-T OFDM carriers, 32 = 32k, 16 = 16k, 8 = 8k, 4 = 4k, 2 = 2k, 1 = 1k. If in doubt, try 8k.
 
 \fBHierarchy:\fR If set to 1, this transponder uses two streams, high priority and low priority.
-If in doubt, try 0 (off). (DVB-T only).
+If in doubt, try 0 (off). (DVB-T/T2 only).
 
-\fBDelivery System:\fR The satellite delivery system (0 = DVB-S, 1 = DVB-S2).
+\fBDelivery System:\fR The delivery system (0 = DVB-S, 1 = DVB-S2, 2 = DVB-T, 3 = DVB-T2).
 
 \fBPolarization:\fR Satellite antenna polarization.
 H = horizontal, V = vertical, R = circular right, L = circular left.
@@ -152,7 +157,10 @@
 will automatically determine the proper value (if possible).
 
 An example of a parameter field for a DVB-T channel might look like this:
-\fBB8C23D12G8M16T8Y0\fR
+\fBB8C23D12G8M16T8Y0S2\fR
+
+An example of a parameter field for a DVB-T2 channel might look like this:
+\fBB8C23D12G8M16T8Y0P0S3\fR
 
 An example of a parameter field for a DVB-C channel might look like this:
 \fBC0M64\fR
